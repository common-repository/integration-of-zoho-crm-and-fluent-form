var A=Object.defineProperty;var $=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var O=(t,l,i)=>l in t?A(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i,h=(t,l)=>{for(var i in l||(l={}))j.call(l,i)&&O(t,i,l[i]);if($)for(var i of $(l))L.call(l,i)&&O(t,i,l[i]);return t};import{_ as r,c,s as S}from"./bi-9-8.js";const J=(t,l,i,f,o,s,e,a,n,d)=>{let u=h({},i);if(l===0){if(a){const y=h({},n);y[t.target.name]="",d(h({},y))}u[t.target.name]=t.target.value}else u.relatedlists||(u.relatedlists=[]),u.relatedlists[l-1][t.target.name]=t.target.value;switch(t.target.name){case"module":u=E(l,o,u,f,s,e);break;case"layout":u=v(l,o,u);break}f(h({},u))},N=(t,l,i,f,o,s,e)=>{var a,n;t&&(n=(a=f.default)==null?void 0:a.relatedlists)!=null&&n[f.module],l(t)},E=(t,l,i,f,o,s)=>{var n,d;let e=h({},i);const a=t===0?e.module:e.relatedlists[t-1].module;if(e.relatedlists[t-1]||(e.relatedlists[t-1]={}),t===0?(e.layout="",e.actions={},e.field_map=[{formField:"",zohoFormField:""}],e.upload_field_map=[{formField:"",zohoFormField:""}],e.relatedlists=[]):(e.relatedlists[t-1].layout="",e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=[{formField:"",zohoFormField:""}]),!((n=e.default.layouts)!=null&&n[a]))Z(t,l,e,f,o,s);else{const u=Object.keys((d=e.default.layouts)==null?void 0:d[a]);u.length===1&&(t===0?[e.layout]=u:[e.relatedlists[t-1].layout]=u,e=v(t,l,e))}return e},v=(t,l,i,f,o,s)=>{var d,u,y,F,p,z,g,_,k,R,I,w,q,U,M,D;const e=h({},i),a=t===0?e.module:e.relatedlists[t-1].module,n=t===0?e.layout:e.relatedlists[t-1].layout;return t===0?(e.actions={},e.field_map=(F=(y=(u=(d=e==null?void 0:e.default)==null?void 0:d.layouts)==null?void 0:u[a])==null?void 0:y[n])!=null&&F.required?m(t,e):[{formField:"",zohoFormField:""}],e.upload_field_map=(_=(g=(z=(p=e==null?void 0:e.default)==null?void 0:p.layouts)==null?void 0:z[a])==null?void 0:g[n])!=null&&_.requiredFileUploadFields&&Object.keys(e.default.layouts[a][n].requiredFileUploadFields).length>0?m(t,e,!0):[{formField:"",zohoFormField:""}]):(e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=(w=(I=(R=(k=e==null?void 0:e.default)==null?void 0:k.layouts)==null?void 0:R[a])==null?void 0:I[n])!=null&&w.required?m(t,e):[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=(D=(M=(U=(q=e==null?void 0:e.default)==null?void 0:q.layouts)==null?void 0:U[a])==null?void 0:M[n])!=null&&D.requiredFileUploadFields&&Object.keys(e.default.layouts[a][n].requiredFileUploadFields).length>0?m(t,e,!0):[{formField:"",zohoFormField:""}]),e},W=(t,l,i,f,o)=>{f(!0);const s={formID:t,id:l.id,dataCenter:l.dataCenter,clientId:l.clientId,clientSecret:l.clientSecret,tokenDetails:l.tokenDetails};c(s,"zcrm_refresh_modules").then(e=>{if(e&&e.success){const a=h({},l);a.default||(a.default={}),e.data.modules&&(a.default.modules=e.data.modules),e.data.tokenDetails&&(a.tokenDetails=e.data.tokenDetails),i(h({},a)),o({show:!0,msg:r("Modules refreshed","bitffzc")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:S(r("Modules refresh failed Cause: %s. please try again","bitffzc"),e.data.data||e.data)}):o({show:!0,msg:r("Modules refresh failed. please try again","bitffzc")});f(!1)}).catch(()=>f(!1))},Z=(t,l,i,f,o,s)=>{const e=h({},i),a=t===0?e.module:e.relatedlists[t-1].module;if(!a)return;o(!0);const n={formID:l,module:a,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};c(n,"zcrm_refresh_layouts").then(d=>{var u,y;if(d&&d.success){if(d.data.layouts){e.default.layouts||(e.default.layouts={}),e.default.layouts[a]=d.data.layouts;const F=[...Object.keys(d.data.layouts)];F.length===1&&(t===0?([e.layout]=F,e.field_map=m(t,e),Object.keys(d.data.layouts[F].fileUploadFields).length>0&&(e.upload_field_map=m(t,e,!0))):([e.relatedlists[t-1].layout]=F,e.relatedlists[t-1].field_map=m(t,e),Object.keys(d.data.layouts[F].fileUploadFields).length>0&&(e.relatedlists[t-1].upload_field_map=m(t,e,!0))),(u=e.default.tags)!=null&&u[a]||refreshTags(t,l,e,f,o,s))}d.data.tokenDetails&&(e.tokenDetails=d.data.tokenDetails),f(h({},e)),s({show:!0,msg:r("Layouts refreshed","bitffzc")})}else(y=d==null?void 0:d.data)!=null&&y.data||!d.success&&typeof d.data=="string"?s({show:!0,msg:S(r("Layouts refresh failed Cause: %s. please try again","bitffzc"),d.data.data||d.data)}):s({show:!0,msg:r("Layouts refresh failed. please try again","bitffzc")});o(!1)}).catch(()=>o(!1))},m=(t,l,i)=>{const f=t===0?l.module:l.relatedlists[t-1].module,o=t===0?l.layout:l.relatedlists[t-1].layout;return i?l.default.layouts[f][o].requiredFileUploadFields.length>0?l.default.layouts[f][o].requiredFileUploadFields.map(s=>({formField:"",zohoFormField:s})):[{formField:"",zohoFormField:""}]:l.default.layouts[f][o].required.length>0?l.default.layouts[f][o].required.map(s=>({formField:"",zohoFormField:s})):[{formField:"",zohoFormField:""}]},B=t=>{const l=t!=null&&t.field_map?t.field_map.filter(s=>{var e,a,n,d;return!s.formField&&s.zohoFormField&&((d=(n=(a=(e=t==null?void 0:t.default)==null?void 0:e.layouts)==null?void 0:a[t.module])==null?void 0:n[t.layout])==null?void 0:d.required.indexOf(s.zohoFormField))!==-1}):[],i=t!=null&&t.upload_field_map?t.upload_field_map.filter(s=>!s.formField&&s.zohoFormField&&t.default.layouts[t.module][t.layout].requiredFileUploadFields.indexOf(s.zohoFormField)!==-1):[],f=t.relatedlists.map(s=>s.field_map.filter(e=>!e.formField&&e.zohoFormField)),o=t.relatedlists.map(s=>s.upload_field_map.filter(e=>!e.formField&&e.zohoFormField));return!(l.length>0||i.length>0||f.some(s=>s.length)||o.some(s=>s.length))},G=(t,l,i,f,o,s)=>{if(!t.dataCenter||!t.clientId||!t.clientSecret){i({dataCenter:t.dataCenter?"":r("Data center cann't be empty","bitffzc"),clientId:t.clientId?"":r("Client ID cann't be empty","bitffzc"),clientSecret:t.clientSecret?"":r("Secret key cann't be empty","bitffzc")});return}o(!0);const e="ZohoCRM.modules.ALL,ZohoCRM.settings.ALL,ZohoCRM.users.Read,zohocrm.files.CREATE",a=`https://accounts.zoho.${t.dataCenter}/oauth/v2/auth?scope=${e}&response_type=code&client_id=${t.clientId}&prompt=Consent&access_type=offline&redirect_uri=${bitffzc==null?void 0:bitffzc.redirect}&state=${encodeURIComponent(window.location.href)}/redirect`,n=window.open(a,"zohoCRM","width=400,height=609,toolbar=off"),d=setInterval(()=>{if(n.closed){clearInterval(d);let u={},y=!1;const F=localStorage.getItem("__bitforms_zohoCRM");if(F&&(y=!0,u=JSON.parse(F),localStorage.removeItem("__bitforms_zohoCRM")),!u.code||u.error||!u||!y){const p=u.error?`Cause: ${u.error}`:"";s({show:!0,msg:`${r("Authorization failed","bitffzc")} ${p}. ${r("please try again","bitffzc")}`}),o(!1)}else{const p=h({},t);p.accountServer=u["accounts-server"],x(u,p,l,f,o,s)}}},500)},x=(t,l,i,f,o,s)=>{const e=h({},t);e.dataCenter=l.dataCenter,e.clientId=l.clientId,e.clientSecret=l.clientSecret,e.redirectURI=bitffzc==null?void 0:bitffzc.redirect,c(e,"zcrm_generate_token").then(a=>a).then(a=>{if(a&&a.success){const n=h({},l);n.tokenDetails=a.data,i(n),f(!0),s({show:!0,msg:r("Authorized Successfully","bitffzc")})}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?s({show:!0,msg:`${r("Authorization failed Cause:","bitffzc")}${a.data.data||a.data}. ${r("please try again","bitffzc")}`}):s({show:!0,msg:r("Authorization failed. please try again","bitffzc")});o(!1)})};export{N as a,W as b,B as c,G as d,J as h,Z as r};
